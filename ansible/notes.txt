
# ansible-galaxy role init common

# vi common/tasks/main.yml 

###############
---

- include_tasks: redhat.yml
  when: ansible_os_family == "RedHat"
  tags:
    - rhel-common

- include_tasks: debian.yml
  when: ansible_os_family == "Debian"
  tags:
    - debian-common


# vi site.yml 

--- 

- hosts: all
  gather_facts: True
  roles:
    - common

- import_playbook: vmware.yml


#####
---

- hosts: all
  gather_facts: True
  tasks:
    - name: "check pkgs installed" 
      package_facts: 
        manager: auto

    - name: Print the package facts
      debug:
        var: ansible_facts.packages
    
    - name: "check if oracle jdk installed" 
      debug:
        msg: "jdk installed" 
      when: "'java' in ansible_facts.packages" 
  
  

### 

--- 

- hosts: all 
  gather_facts: True
  become: True
  tasks: 
    - name: "install pkgs"
      package: 
        name: "{{ item }}"
        state: present
      loop:
        - sendmail
        
        
        
#####


- name: "Group nodes by OS distribution"
  hosts: all
  gather_facts: true
  tasks:
    - name: group hosts by distribution
      group_by: 
        key: "{{ ansible_distribution }}_{{ ansible_distribution_major_version }}"
      changed_when: false



####

- hosts: all 
  gather_facts: False
  pre_tasks:
    - name: "setup pre-task command" 
      setup:
        filter: ansible_distribution
       vars:
         ansible_password: '{{ lookup("env", "ANSIBLE_PASSWORD") }}'
  tasks:
    - name: "command task"
      command:
        cmd: uptime 
        
        
####
######## doesn't work 
- hosts: all 
  gather_facts: False
  pre_tasks:
    - name: "setup pre-task command" 
      setup:
        filter: ansible_distribution
       vars:
         ansible_password: "{{ item }}"
       loop:
         - pass1
         - pass2
         - pass3
        ignore_errors: True
  tasks:
    - name: "command task"
      command:
        cmd: uptime 
        
